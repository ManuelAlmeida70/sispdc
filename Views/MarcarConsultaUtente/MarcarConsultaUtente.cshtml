

@{
    Layout = "_LayoutUtente";
    ViewData["Title"] = "Marcar Consulta";
}

<!-- Main Content -->
<div class="container pb-5">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="@Url.Action("Index", "HomeUtente")">Início</a></li>
            <li class="breadcrumb-item active" aria-current="page">Marcar Consulta</li>
        </ol>
    </nav>

    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex align-items-center">
                <i class="bi bi-calendar-plus text-primary fs-1 me-3"></i>
                <div>
                    <h2 class="mb-1">Marcar Nova Consulta</h2>
                    <p class="text-muted mb-0">Agende uma consulta médica de forma simples e rápida</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Form Column -->
        <div class="col-lg-8">
            <div class="info-card">
                <form asp-action="MarcarConsulta" method="post" id="formMarcarConsulta">
                    <input type="hidden"  />

                    <!-- Etapa 1: Especialidade e Médico -->
                    <div class="mb-4">
                        <h5 class="section-title"><i class="bi bi-1-circle me-2"></i>Escolha a Especialidade e Médico</h5>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Especialidade <span class="text-danger">*</span></label>
                                <select class="form-select" id="especialidade" required>
                                    <option value="">Selecione uma especialidade</option>
                                    <option value="1">Cardiologia</option>
                                    <option value="2">Dermatologia</option>
                                    <option value="3">Ginecologia</option>
                                    <option value="4">Oftalmologia</option>
                                    <option value="5">Ortopedia</option>
                                    <option value="6">Pediatria</option>
                                    <option value="7">Psiquiatria</option>
                                    <option value="8">Medicina Geral</option>
                                </select>
                            </div>

                            <div class="col-md-6 mb-3">
                                <i class="bi bi-exclamation-circle"></i>
                                <small class="text-muted text-dark text-bg-warning">Medico sera atribuído automaticamente</small>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- Etapa 2: Data e Hora -->
                    <div class="mb-4">
                        <h5 class="section-title"><i class="bi bi-2-circle me-2"></i>Escolha Data e Hora</h5>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Data da Consulta <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" required
                                       min="@DateTime.Now.ToString("yyyy-MM-dd")" />
                                <span  class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Hora da Consulta <span class="text-danger">*</span></label>
                                <select  class="form-select" required>
                                    <option value="">Selecione uma hora</option>
                                    <option value="07:00">07:00</option>
                                    <option value="07:30">07:30</option>
                                    <option value="08:00">08:00</option>
                                    <option value="08:30">08:30</option>
                                    <option value="09:00">09:00</option>
                                    <option value="09:30">09:30</option>
                                    <option value="10:00">10:00</option>
                                    <option value="10:30">10:30</option>
                                    <option value="11:00">11:00</option>
                                    <option value="11:30">11:30</option>
                                    <option value="12:00">12:00</option>
                                    <option value="14:00">14:00</option>
                                    <option value="14:30">14:30</option>
                                    <option value="15:00">15:00</option>
                                    <option value="15:30">15:30</option>
                                    <option value="16:00">16:00</option>
                                    <option value="16:30">16:30</option>
                                    <option value="17:00">17:00</option>
                                    <option value="17:30">17:30</option>
                                    <option value="18:00">18:00</option>
                                    <option value="18:30">18:30</option>
                                    <option value="19:00">19:00</option>
                                    <option value="19:30">19:30</option>
                                    <option value="20:00">20:00</option>
                                </select>
                                <span  class="text-danger"></span>
                                <small class="text-muted">Horário de funcionamento: 07:00 às 20:00</small>
                            </div>
                        </div>

                        <!-- Disponibilidade -->
                        <div class="alert alert-info" id="disponibilidadeInfo" style="display:none;">
                            <i class="bi bi-info-circle me-2"></i>
                            <span id="disponibilidadeTexto"></span>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- Etapa 3: Detalhes -->
                    <div class="mb-4">
                        <h5 class="section-title"><i class="bi bi-3-circle me-2"></i>Detalhes da Consulta</h5>

                        <div class="mb-3">
                            <label  class="form-label fw-bold">Motivo da Consulta</label>
                            <input a type="text" class="form-control"
                                   placeholder="Ex: Consulta de rotina, dores no peito, etc." maxlength="200" />
                            <span  class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label  class="form-label fw-bold">Observações Adicionais</label>
                            <textarea  class="form-control" rows="4"
                                      placeholder="Descreva sintomas, histórico recente ou outras informações relevantes para o médico..."
                                      maxlength="500"></textarea>
                            <span  class="text-danger"></span>
                            <small class="text-muted">Máximo 500 caracteres</small>
                        </div>
                    </div>

                    <!-- Botões de Ação -->
                    <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
                        <a href="@Url.Action("Index", "HomeUtente")" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left me-2"></i>Voltar
                        </a>
                        <div>
                            <button type="reset" class="btn btn-outline-danger me-2">
                                <i class="bi bi-x-circle me-2"></i>Limpar
                            </button>
                            <button type="submit" class="btn btn-primary btn-custom">
                                <i class="bi bi-check-circle me-2"></i>Confirmar Marcação
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Info Sidebar -->
        <div class="col-lg-4">
            <!-- Informações Importantes -->
            <div class="info-card">
                <h5 class="section-title small"><i class="bi bi-info-circle me-2"></i>Informações Importantes</h5>
                <div class="mb-3">
                    <div class="d-flex align-items-start mb-2">
                        <i class="bi bi-check-circle text-success me-2 mt-1"></i>
                        <small>Chegue com 15 minutos de antecedência</small>
                    </div>
                    <div class="d-flex align-items-start mb-2">
                        <i class="bi bi-check-circle text-success me-2 mt-1"></i>
                        <small>Traga documento de identificação e cartão do seguro</small>
                    </div>
                    <div class="d-flex align-items-start mb-2">
                        <i class="bi bi-check-circle text-success me-2 mt-1"></i>
                        <small>Liste todos os medicamentos que está a tomar</small>
                    </div>
                    <div class="d-flex align-items-start">
                        <i class="bi bi-check-circle text-success me-2 mt-1"></i>
                        <small>Traga exames anteriores relacionados</small>
                    </div>
                </div>
            </div>

            <!-- Políticas de Cancelamento -->
            <div class="info-card">
                <h5 class="section-title small"><i class="bi bi-exclamation-triangle me-2"></i>Política de Cancelamento</h5>
                <small class="text-muted">
                    Cancelamentos devem ser feitos com pelo menos 24 horas de antecedência.
                    Ausências não justificadas podem resultar em taxas adicionais.
                </small>
            </div>

            <!-- Contacto de Emergência -->
            <div class="info-card">
                <h5 class="section-title small"><i class="bi bi-telephone me-2"></i>Precisa de Ajuda?</h5>
                <div class="mb-2">
                    <small class="text-muted">Telefone:</small>
                    <p class="mb-1 fw-bold">+244 923 456 789</p>
                </div>
                <div class="mb-2">
                    <small class="text-muted">Email:</small>
                    <p class="mb-0 fw-bold">consultas@hospital.ao</p>
                </div>
                <small class="text-muted d-block mt-2">
                    Horário de atendimento: Seg-Sex, 08:00-17:00
                </small>
            </div>

            <!-- Consultas Recentes -->
            <div class="info-card">
                <h5 class="section-title small"><i class="bi bi-clock-history me-2"></i>Últimas Consultas</h5>
                <div class="list-group list-group-flush">
                    <div class="list-group-item px-0 py-2">
                        <small class="d-block fw-bold">Cardiologia</small>
                        <small class="text-muted">Dr. João Silva - 05 Dez, 2024</small>
                    </div>
                    <div class="list-group-item px-0 py-2">
                        <small class="d-block fw-bold">Medicina Geral</small>
                        <small class="text-muted">Dra. Maria Santos - 15 Nov, 2024</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Simular carregamento de médicos por especialidade
            $('#especialidade').change(function() {
                var especialidadeId = $(this).val();
                var $medicoSelect = $('#medico');

                $medicoSelect.html('<option value="">Carregando...</option>');

                if (especialidadeId) {
                    // Aqui você faria uma chamada AJAX para buscar os médicos
                    // Exemplo simulado:
                    setTimeout(function() {
                        $medicoSelect.html(`
                            <option value="">Atribuir automaticamente</option>
                            <option value="1">Dr. João Silva</option>
                            <option value="2">Dra. Maria Santos</option>
                            <option value="3">Dr. Pedro Costa</option>
                        `);
                    }, 500);
                } else {
                    $medicoSelect.html('<option value="">Primeiro selecione a especialidade</option>');
                }
            });

            // Verificar disponibilidade ao mudar data/hora
            $('#dataConsulta, #horaConsulta').change(function() {
                var data = $('#dataConsulta').val();
                var hora = $('#horaConsulta').val();

                if (data && hora) {
                    // Aqui você faria uma chamada AJAX para verificar disponibilidade
                    $('#disponibilidadeInfo').show();
                    $('#disponibilidadeTexto').text('Horário disponível! Você pode prosseguir com a marcação.');
                }
            });

            // Contador de caracteres para observações
            $('textarea[name="observacoes"]').on('input', function() {
                var length = $(this).val().length;
                var max = 500;
                $(this).next('.text-muted').text(`${length}/${max} caracteres`);
            });
        });
    </script>
}